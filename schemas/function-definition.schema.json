{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://vnext.com/schemas/function-definition.schema.json",
    "title": "vNext Function Definition",
    "description": "Schema for vNext Function Component Definition JSON files (sys-functions flow)",
    "allOf": [
        {
            "$ref": "component-base.schema.json"
        },
        {
            "type": "object",
            "properties": {
                "flow": {
                    "type": "string",
                    "description": "Flow identifier for functions",
                    "const": "sys-functions"
                },
                "tags": {
                    "type": "array",
                    "description": "Function tags",
                    "items": {
                        "type": "string"
                    },
                    "minItems": 1
                },
                "attributes": {
                    "type": "object",
                    "description": "Function definition attributes",
                    "required": [
                        "scope",
                        "task",
                        "mapping"
                    ],
                    "properties": {
                "scope": {
                    "type": "integer",
                    "description": "Function scope (TaskScope enum value)",
                    "oneOf": [
                        {
                            "const": 1,
                            "description": "State OnEntry scope"
                        },
                        {
                            "const": 2,
                            "description": "State OnExit scope"
                        },
                        {
                            "const": 3,
                            "description": "Transition OnExecute scope"
                        },
                        {
                            "const": 4,
                            "description": "Workflow OnStart scope"
                        },
                        {
                            "const": 5,
                            "description": "Workflow OnEnd scope"
                        }
                    ]
                },
                "task": {
                    "type": "object",
                    "description": "Function execution task",
                    "required": [
                        "order",
                        "task",
                        "mapping"
                    ],
                    "properties": {
                        "order": {
                            "type": "integer",
                            "description": "Task execution order",
                            "minimum": 1
                        },
                        "task": {
                            "$ref": "task-reference.schema.json"
                        },
                        "mapping": {
                            "type": "object",
                            "description": "Function mapping code",
                            "required": [
                                "location",
                                "code"
                            ],
                            "properties": {
                                "location": {
                                    "type": "string",
                                    "description": "Code file location",
                                    "pattern": "^\\./.*\\.csx$"
                                },
                                "code": {
                                    "type": "string",
                                    "description": "Mapping code content",
                                    "minLength": 1
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "additionalProperties": false
                },
                "labels": {
                    "type": "array",
                    "description": "Multi-language labels for function",
                    "items": {
                        "type": "object",
                        "required": [
                            "label",
                            "language"
                        ],
                        "properties": {
                            "label": {
                                "type": "string",
                                "minLength": 1
                            },
                            "language": {
                                "type": "string",
                                "pattern": "^[a-z]{2}-[A-Z]{2}$",
                                "examples": [
                                    "en-US",
                                    "tr-TR",
                                    "de-DE"
                                ]
                            }
                        }
                    }
                }
            },
            "additionalProperties": false
        }
            }
        }
    ],
    "additionalProperties": false
}